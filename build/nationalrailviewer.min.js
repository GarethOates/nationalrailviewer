/// <reference path="../../typings/tsd.d.ts" />
/// <reference path="../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        angular.module("nationalRailViewer", ["ngRoute", "toastr", "ngAnimate"]);
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../typings/tsd.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        (function () {
            function configure($routeProvider) {
                $routeProvider.when("/:City", {
                    templateUrl: "build/views/main.html",
                    controller: "MainController",
                    controllerAs: "vm"
                }).otherwise({
                    redirectTo: "/Aberdeen"
                });
            }
            configure.$inject = ['$routeProvider'];
            angular.module("nationalRailViewer").config(configure);
        })();
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        var Journey = (function () {
            function Journey() {
            }
            return Journey;
        })();
        Services.Journey = Journey;
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        'use-strict';
        var QueryResult = (function () {
            function QueryResult(trainServices) {
                this.trainServices = trainServices;
            }
            return QueryResult;
        })();
        Services.QueryResult = QueryResult;
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        var TrainServices = (function () {
            function TrainServices() {
            }
            return TrainServices;
        })();
        Services.TrainServices = TrainServices;
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        'use-strict';
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        'use-strict';
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        'use-strict';
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        'use strict';
        var MainController = (function () {
            function MainController(NationalRail, $interval, $routeParams, toastr) {
                this.NationalRail = NationalRail;
                this.$interval = $interval;
                this.$routeParams = $routeParams;
                this.toastr = toastr;
                this.onGetDeparturesComplete = function (data) {
                    this.departures = data;
                };
                this.onGetArrivalsComplete = function (data) {
                    this.arrivals = data;
                };
                this.isErrorRaised = false;
                this.GetData = function () {
                    this.NationalRail.getDepartures(this.city).then(this.onGetDeparturesComplete, this.onError);
                    this.NationalRail.getArrivals(this.city).then(this.onGetArrivalsComplete, this.onError);
                };
                this.city = $routeParams.City;
                this.GetData();
                this.$interval(this.GetData, 60000);
            }
            ;
            MainController.prototype.onError = function ($error) {
                if (!this.isErrorRaised) {
                    toastr.error('Could not load data for "' + this.city + '"', 'Error');
                    this.isErrorRaised = !this.isErrorRaised;
                }
            };
            ;
            MainController.$inject = ['NationalRail', '$interval', '$routeParams', 'toastr'];
            return MainController;
        })();
        Services.MainController = MainController;
        var appModule = angular.module('NationalRailViewer');
        appModule.controller('MainController', ['NationalRail', '$interval', '$routeParams', 'toastr',
            function (NationalRail, $interval, $routeParams, toastr) { return new App.Services.MainController(NationalRail, $interval, $routeParams, toastr); }]);
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
/// <reference path="../../../../typings/tsd.d.ts" />
/// <reference path="../../../../typings/app.d.ts" />
var App;
(function (App) {
    var Services;
    (function (Services) {
        var NationalRailService = (function () {
            function NationalRailService($http) {
                this.http = $http;
            }
            NationalRailService.prototype.getDepartures = function (city) {
                return this.http.get("http://nationalrail.azurewebsites.net/departures/" + city)
                    .then(function (response) {
                    return response.data;
                });
            };
            NationalRailService.prototype.getArrivals = function (city) {
                return this.http.get("http://nationalrail.azurewebsites.net/arrivals/" + city)
                    .then(function (response) {
                    return response.data;
                });
            };
            NationalRailService.$inject = ['$http'];
            return NationalRailService;
        })();
        Services.NationalRailService = NationalRailService;
        var appModule = angular.module('NationalRailService');
        appModule.factory('NationalRail', ['$http', function ($http) { return new App.Services.NationalRailService($http); }]);
    })(Services = App.Services || (App.Services = {}));
})(App || (App = {}));
